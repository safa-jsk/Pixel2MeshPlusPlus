#0 building with "default" instance using docker driver

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 2.69kB done
#1 DONE 0.0s

#2 [internal] load metadata for docker.io/tensorflow/tensorflow:2.6.0-gpu
#2 DONE 0.4s

#3 [internal] load .dockerignore
#3 transferring context: 2B done
#3 DONE 0.0s

#4 [ 1/10] FROM docker.io/tensorflow/tensorflow:2.6.0-gpu@sha256:e0510bc8ea7dfed3b1381f92891fae3ad5b75712984c3632a60cc164391bca29
#4 resolve docker.io/tensorflow/tensorflow:2.6.0-gpu@sha256:e0510bc8ea7dfed3b1381f92891fae3ad5b75712984c3632a60cc164391bca29 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 1.31kB done
#5 DONE 0.0s

#6 [ 2/10] RUN rm -f /etc/apt/sources.list.d/cuda.list /etc/apt/sources.list.d/nvidia-ml.list || true
#6 CACHED

#7 [ 4/10] COPY env/gpu/requirements_gpu.txt /tmp/requirements_gpu.txt
#7 CACHED

#8 [ 5/10] RUN grep -v "tensorflow" /tmp/requirements_gpu.txt > /tmp/requirements_extra.txt &&     pip install --upgrade pip &&     pip install -r /tmp/requirements_extra.txt &&     pip install tflearn opencv-python-headless==4.5.5.64
#8 CACHED

#9 [ 6/10] COPY external /workspace/external
#9 CACHED

#10 [ 3/10] RUN apt-get update && apt-get install -y     build-essential     git     wget     curl     vim     bc     && rm -rf /var/lib/apt/lists/*
#10 CACHED

#11 [ 7/10] WORKDIR /workspace/external
#11 CACHED

#12 [ 8/10] RUN TF_CFLAGS=$(python3 -c 'import tensorflow as tf; print(" ".join(tf.sysconfig.get_compile_flags()))') &&     TF_LFLAGS=$(python3 -c 'import tensorflow as tf; print(" ".join(tf.sysconfig.get_link_flags()))') &&     echo "TF_CFLAGS: $TF_CFLAGS" &&     echo "TF_LFLAGS: $TF_LFLAGS" &&     nvcc -std=c++11 -c -o tf_nndistance_g.cu.o tf_nndistance_g.cu         $TF_CFLAGS -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC -O2 --expt-relaxed-constexpr &&     g++ -std=c++11 tf_nndistance.cpp tf_nndistance_g.cu.o -o tf_nndistance_so.so         -shared -fPIC $TF_CFLAGS -lcudart $TF_LFLAGS -O2 &&     nvcc -std=c++11 -c -o tf_approxmatch_g.cu.o tf_approxmatch_g.cu         $TF_CFLAGS -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC -O2 --expt-relaxed-constexpr &&     g++ -std=c++11 tf_approxmatch.cpp tf_approxmatch_g.cu.o -o tf_approxmatch_so.so         -shared -fPIC $TF_CFLAGS -lcudart $TF_LFLAGS -O2 &&     ls -lh *.so &&     echo "✓ Custom CUDA ops compiled successfully"
#12 2.019 TF_CFLAGS: -I/usr/local/lib/python3.6/dist-packages/tensorflow/include -D_GLIBCXX_USE_CXX11_ABI=0 -DEIGEN_MAX_ALIGN_BYTES=64
#12 2.019 TF_LFLAGS: -L/usr/local/lib/python3.6/dist-packages/tensorflow -l:libtensorflow_framework.so.2
#12 6.415 /usr/bin/ld: cannot find -lcudart
#12 6.415 collect2: error: ld returned 1 exit status
#12 ERROR: process "/bin/bash -c TF_CFLAGS=$(python3 -c 'import tensorflow as tf; print(\" \".join(tf.sysconfig.get_compile_flags()))') &&     TF_LFLAGS=$(python3 -c 'import tensorflow as tf; print(\" \".join(tf.sysconfig.get_link_flags()))') &&     echo \"TF_CFLAGS: $TF_CFLAGS\" &&     echo \"TF_LFLAGS: $TF_LFLAGS\" &&     nvcc -std=c++11 -c -o tf_nndistance_g.cu.o tf_nndistance_g.cu         $TF_CFLAGS -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC -O2 --expt-relaxed-constexpr &&     g++ -std=c++11 tf_nndistance.cpp tf_nndistance_g.cu.o -o tf_nndistance_so.so         -shared -fPIC $TF_CFLAGS -lcudart $TF_LFLAGS -O2 &&     nvcc -std=c++11 -c -o tf_approxmatch_g.cu.o tf_approxmatch_g.cu         $TF_CFLAGS -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC -O2 --expt-relaxed-constexpr &&     g++ -std=c++11 tf_approxmatch.cpp tf_approxmatch_g.cu.o -o tf_approxmatch_so.so         -shared -fPIC $TF_CFLAGS -lcudart $TF_LFLAGS -O2 &&     ls -lh *.so &&     echo \"✓ Custom CUDA ops compiled successfully\"" did not complete successfully: exit code: 1
------
 > [ 8/10] RUN TF_CFLAGS=$(python3 -c 'import tensorflow as tf; print(" ".join(tf.sysconfig.get_compile_flags()))') &&     TF_LFLAGS=$(python3 -c 'import tensorflow as tf; print(" ".join(tf.sysconfig.get_link_flags()))') &&     echo "TF_CFLAGS: $TF_CFLAGS" &&     echo "TF_LFLAGS: $TF_LFLAGS" &&     nvcc -std=c++11 -c -o tf_nndistance_g.cu.o tf_nndistance_g.cu         $TF_CFLAGS -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC -O2 --expt-relaxed-constexpr &&     g++ -std=c++11 tf_nndistance.cpp tf_nndistance_g.cu.o -o tf_nndistance_so.so         -shared -fPIC $TF_CFLAGS -lcudart $TF_LFLAGS -O2 &&     nvcc -std=c++11 -c -o tf_approxmatch_g.cu.o tf_approxmatch_g.cu         $TF_CFLAGS -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC -O2 --expt-relaxed-constexpr &&     g++ -std=c++11 tf_approxmatch.cpp tf_approxmatch_g.cu.o -o tf_approxmatch_so.so         -shared -fPIC $TF_CFLAGS -lcudart $TF_LFLAGS -O2 &&     ls -lh *.so &&     echo "✓ Custom CUDA ops compiled successfully":
2.019 TF_CFLAGS: -I/usr/local/lib/python3.6/dist-packages/tensorflow/include -D_GLIBCXX_USE_CXX11_ABI=0 -DEIGEN_MAX_ALIGN_BYTES=64
2.019 TF_LFLAGS: -L/usr/local/lib/python3.6/dist-packages/tensorflow -l:libtensorflow_framework.so.2
6.415 /usr/bin/ld: cannot find -lcudart
6.415 collect2: error: ld returned 1 exit status
------
Dockerfile:41
--------------------
  40 |     # Compile custom CUDA ops for chamfer distance  
  41 | >>> RUN TF_CFLAGS=$(python3 -c 'import tensorflow as tf; print(" ".join(tf.sysconfig.get_compile_flags()))') && \
  42 | >>>     TF_LFLAGS=$(python3 -c 'import tensorflow as tf; print(" ".join(tf.sysconfig.get_link_flags()))') && \
  43 | >>>     echo "TF_CFLAGS: $TF_CFLAGS" && \
  44 | >>>     echo "TF_LFLAGS: $TF_LFLAGS" && \
  45 | >>>     nvcc -std=c++11 -c -o tf_nndistance_g.cu.o tf_nndistance_g.cu \
  46 | >>>         $TF_CFLAGS -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC -O2 --expt-relaxed-constexpr && \
  47 | >>>     g++ -std=c++11 tf_nndistance.cpp tf_nndistance_g.cu.o -o tf_nndistance_so.so \
  48 | >>>         -shared -fPIC $TF_CFLAGS -lcudart $TF_LFLAGS -O2 && \
  49 | >>>     nvcc -std=c++11 -c -o tf_approxmatch_g.cu.o tf_approxmatch_g.cu \
  50 | >>>         $TF_CFLAGS -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC -O2 --expt-relaxed-constexpr && \
  51 | >>>     g++ -std=c++11 tf_approxmatch.cpp tf_approxmatch_g.cu.o -o tf_approxmatch_so.so \
  52 | >>>         -shared -fPIC $TF_CFLAGS -lcudart $TF_LFLAGS -O2 && \
  53 | >>>     ls -lh *.so && \
  54 | >>>     echo "✓ Custom CUDA ops compiled successfully"
  55 |     
--------------------
ERROR: failed to build: failed to solve: process "/bin/bash -c TF_CFLAGS=$(python3 -c 'import tensorflow as tf; print(\" \".join(tf.sysconfig.get_compile_flags()))') &&     TF_LFLAGS=$(python3 -c 'import tensorflow as tf; print(\" \".join(tf.sysconfig.get_link_flags()))') &&     echo \"TF_CFLAGS: $TF_CFLAGS\" &&     echo \"TF_LFLAGS: $TF_LFLAGS\" &&     nvcc -std=c++11 -c -o tf_nndistance_g.cu.o tf_nndistance_g.cu         $TF_CFLAGS -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC -O2 --expt-relaxed-constexpr &&     g++ -std=c++11 tf_nndistance.cpp tf_nndistance_g.cu.o -o tf_nndistance_so.so         -shared -fPIC $TF_CFLAGS -lcudart $TF_LFLAGS -O2 &&     nvcc -std=c++11 -c -o tf_approxmatch_g.cu.o tf_approxmatch_g.cu         $TF_CFLAGS -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC -O2 --expt-relaxed-constexpr &&     g++ -std=c++11 tf_approxmatch.cpp tf_approxmatch_g.cu.o -o tf_approxmatch_so.so         -shared -fPIC $TF_CFLAGS -lcudart $TF_LFLAGS -O2 &&     ls -lh *.so &&     echo \"✓ Custom CUDA ops compiled successfully\"" did not complete successfully: exit code: 1
#0 building with "default" instance using docker driver

#1 [internal] load build definition from Dockerfile
#1 transferring dockerfile: 2.74kB done
#1 DONE 0.0s

#2 [internal] load metadata for docker.io/tensorflow/tensorflow:2.6.0-gpu
#2 DONE 1.0s

#3 [internal] load .dockerignore
#3 transferring context: 2B done
#3 DONE 0.0s

#4 [ 1/10] FROM docker.io/tensorflow/tensorflow:2.6.0-gpu@sha256:e0510bc8ea7dfed3b1381f92891fae3ad5b75712984c3632a60cc164391bca29
#4 resolve docker.io/tensorflow/tensorflow:2.6.0-gpu@sha256:e0510bc8ea7dfed3b1381f92891fae3ad5b75712984c3632a60cc164391bca29 done
#4 DONE 0.0s

#5 [internal] load build context
#5 transferring context: 1.31kB done
#5 DONE 0.0s

#6 [ 6/10] COPY external /workspace/external
#6 CACHED

#7 [ 3/10] RUN apt-get update && apt-get install -y     build-essential     git     wget     curl     vim     bc     && rm -rf /var/lib/apt/lists/*
#7 CACHED

#8 [ 4/10] COPY env/gpu/requirements_gpu.txt /tmp/requirements_gpu.txt
#8 CACHED

#9 [ 5/10] RUN grep -v "tensorflow" /tmp/requirements_gpu.txt > /tmp/requirements_extra.txt &&     pip install --upgrade pip &&     pip install -r /tmp/requirements_extra.txt &&     pip install tflearn opencv-python-headless==4.5.5.64
#9 CACHED

#10 [ 2/10] RUN rm -f /etc/apt/sources.list.d/cuda.list /etc/apt/sources.list.d/nvidia-ml.list || true
#10 CACHED

#11 [ 7/10] WORKDIR /workspace/external
#11 CACHED

#12 [ 8/10] RUN TF_CFLAGS=$(python3 -c 'import tensorflow as tf; print(" ".join(tf.sysconfig.get_compile_flags()))') &&     TF_LFLAGS=$(python3 -c 'import tensorflow as tf; print(" ".join(tf.sysconfig.get_link_flags()))') &&     echo "TF_CFLAGS: $TF_CFLAGS" &&     echo "TF_LFLAGS: $TF_LFLAGS" &&     nvcc -std=c++11 -c -o tf_nndistance_g.cu.o tf_nndistance_g.cu         $TF_CFLAGS -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC -O2 --expt-relaxed-constexpr &&     g++ -std=c++11 tf_nndistance.cpp tf_nndistance_g.cu.o -o tf_nndistance_so.so         -shared -fPIC $TF_CFLAGS -L/usr/local/cuda/lib64 -lcudart $TF_LFLAGS -O2 &&     nvcc -std=c++11 -c -o tf_approxmatch_g.cu.o tf_approxmatch_g.cu         $TF_CFLAGS -D GOOGLE_CUDA=1 -x cu -Xcompiler -fPIC -O2 --expt-relaxed-constexpr &&     g++ -std=c++11 tf_approxmatch.cpp tf_approxmatch_g.cu.o -o tf_approxmatch_so.so         -shared -fPIC $TF_CFLAGS -L/usr/local/cuda/lib64 -lcudart $TF_LFLAGS -O2 &&     ls -lh *.so &&     echo "✓ Custom CUDA ops compiled successfully"
#12 2.039 TF_CFLAGS: -I/usr/local/lib/python3.6/dist-packages/tensorflow/include -D_GLIBCXX_USE_CXX11_ABI=0 -DEIGEN_MAX_ALIGN_BYTES=64
#12 2.039 TF_LFLAGS: -L/usr/local/lib/python3.6/dist-packages/tensorflow -l:libtensorflow_framework.so.2
#12 9.074 -rwxr-xr-x 1 root root 135K Jan 28 07:46 tf_approxmatch_so.so
#12 9.074 -rwxr-xr-x 1 root root 106K Jan 28 07:46 tf_nndistance_so.so
#12 9.074 ✓ Custom CUDA ops compiled successfully
#12 DONE 9.1s

#13 [ 9/10] WORKDIR /workspace
#13 DONE 0.0s

#14 [10/10] RUN python3 -c "import tensorflow as tf; print('TensorFlow:', tf.__version__); print('CUDA available:', tf.test.is_built_with_cuda())"
#14 0.910 TensorFlow: 2.6.0
#14 0.910 CUDA available: True
#14 DONE 1.1s

#15 exporting to image
#15 exporting layers 0.1s done
#15 exporting manifest sha256:ebff7a593f0ed982087956ec361d74d1a55c1fc9f0497129c9c70fac476b1a71 done
#15 exporting config sha256:9d83b32f3f714cb2a375974e106ece706a5f0a401f944947df5f3e3945e3f68d done
#15 exporting attestation manifest sha256:7601b61080b2df18e02bde1c5458c7129bcf8623c130334ad7ba8d3b9d3f6a32
#15 exporting attestation manifest sha256:7601b61080b2df18e02bde1c5458c7129bcf8623c130334ad7ba8d3b9d3f6a32 done
#15 exporting manifest list sha256:7d5fb08479a96e57f89a94e54b7897d0c3085440989519f0bcad229ad2cd06f4 done
#15 naming to docker.io/library/p2mpp-gpu:v2 done
#15 unpacking to docker.io/library/p2mpp-gpu:v2 0.0s done
#15 DONE 0.2s
